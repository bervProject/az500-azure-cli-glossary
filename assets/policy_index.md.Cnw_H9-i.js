import{_ as i,c as a,ae as e,o as t}from"./chunks/framework.BIgUf7nt.js";const c=JSON.parse('{"title":"Azure Policy","description":"","frontmatter":{"sidebar":"auto","footer":"MIT Licensed and CC BY 4.0 | Copyright © 2020-present Bervianto Leo Pratama"},"headers":[],"relativePath":"policy/index.md","filePath":"policy/index.md"}'),n={name:"policy/index.md"};function l(p,s,h,r,k,o){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="azure-policy" tabindex="-1">Azure Policy <a class="header-anchor" href="#azure-policy" aria-label="Permalink to &quot;Azure Policy&quot;">​</a></h1><h2 id="apply-an-azure-policy" tabindex="-1">Apply an Azure policy <a class="header-anchor" href="#apply-an-azure-policy" aria-label="Permalink to &quot;Apply an Azure policy&quot;">​</a></h2><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Register the resource provider if it&#39;s not already registered</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Register-AzResourceProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ProviderNamespace </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Microsoft.PolicyInsights&#39;</span></span></code></pre></div><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get a reference to the resource group that will be the scope of the assignment</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$rg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Get-AzResourceGroup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;resourceGroupName&gt;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get a reference to the built-in policy definition that will be assigned</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$definition </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Get-AzPolicyDefinition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Where-Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.Properties.DisplayName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-eq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Audit VMs that do not use managed disks&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create the policy assignment with the built-in definition against your resource group</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">New-AzPolicyAssignment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;audit-vm-manageddisks&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DisplayName </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Audit VMs without managed disks Assignment&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Scope $rg.ResourceId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PolicyDefinition $definition</span></span></code></pre></div><h2 id="identify-non-compliant-resources" tabindex="-1">Identify non-compliant resources <a class="header-anchor" href="#identify-non-compliant-resources" aria-label="Permalink to &quot;Identify non-compliant resources&quot;">​</a></h2><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Get-AzPolicyState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ResourceGroupName $rg.ResourceGroupName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PolicyAssignmentName </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;audit-vm-manageddisks&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Filter </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;IsCompliant eq false&#39;</span></span></code></pre></div><h2 id="remove-policy-assignment" tabindex="-1">Remove policy assignment <a class="header-anchor" href="#remove-policy-assignment" aria-label="Permalink to &quot;Remove policy assignment&quot;">​</a></h2><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Remove-AzPolicyAssignment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;audit-vm-manageddisks&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Scope </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/subscriptions/&lt;subscriptionID&gt;/resourceGroups/&lt;resourceGroupName&gt;&#39;</span></span></code></pre></div>`,8)]))}const g=i(n,[["render",l]]);export{c as __pageData,g as default};
